# Table of Contents

* [1 `CPU`主要功能](#1-cpu主要功能)
* [2 `CPU`基本结构](#2-cpu基本结构)
  * [2.1 数据通路](#21-数据通路)
  * [2.2 控制单元](#22-控制单元)
* [3 寄存器](#3-寄存器)
  * [3.1 用户可见寄存器](#31-用户可见寄存器)
  * [3.2 用户部分可见寄存器](#32-用户部分可见寄存器)
  * [3.3 用户不可见寄存器](#33-用户不可见寄存器)
* [4 指令执行过程](#4-指令执行过程)
* [5 三个周期](#5-三个周期)
* [6 数据通路](#6-数据通路)
* [7 控制逻辑单元](#7-控制逻辑单元)
* [8 异常和中断](#8-异常和中断)


﻿
# 1 `CPU`主要功能
- 取指令并译码：从存储器取出指令，并对指令操作码进行译码
- 计算`PC`的值：自动计算`PC`的值来确定下一条指令的地址
- 算术逻辑运算：计算操作数地址，对操作数进行算术或逻辑运算
- 取操作数并写结果：通过控制对存储器或`I/O`接口的访问来读取操作数或写结果
- 异常或中断处理：检测有误异常事件或中断请求，必要时响应并调出相应处理程序执行
- 时序控制：通过生成时钟信号来控制上述每个操作的先后顺序和操作时间

# 2 `CPU`基本结构
主要由：

- 数据通路
- 控制单元

组成。

## 2.1 数据通路
数据通路包含了：

- 组合逻辑单元：对数据进行处理，比如加法器、`ALU`等
- 状态单元：包括触发器、寄存器等，用于对指令执行的中间状态或最终结果进行保存

## 2.2 控制单元
也叫控制器，主要功能是对取出的指令进行译码，并与指令执行得到的条件码或当前机器的状态、时序信号进行组合，生成对数据通路进行控制的控制信号。

# 3 寄存器
`CPU`中的寄存器可以根据对用户是否透明分为如下三类：

- 用户可见寄存器（用户可读可写）
- 用户部分可见寄存器（用户可读不可写）
- 用户不可见寄存器（用户不可读不可写）

## 3.1 用户可见寄存器
用户程序中的指令可直接访问或间接修改其值的寄存器，包括：

- 通用寄存器：可存放地址或数据
- 地址寄存器：专门存放首地址或指针信息
- 程序计数器`PC`：存放当前或下条指令的地址

## 3.2 用户部分可见寄存器
用户可读不可写，包括：

- 程序状态字寄存器`PSWR`
- 标志寄存器`FLAG`

## 3.3 用户不可见寄存器
不可读+不可写，包括：

- 指令寄存器`IR`：存放正在执行的命令，只能被硬件访问
- 存储器地址寄存器`MAR`：存放将要访问的存储单元的地址
- 存储器数据寄存器`MDR`：存放将要访问的存储单元的数据
- 中断请求寄存器

等。

# 4 指令执行过程
大概可以分为：

- 取指
- 译码
- 取数
- 运算
- 存结果
- 查中断


# 5 三个周期
- 指令周期是取出并执行一条指令的时间，由若干个机器周期或直接由若干个时间周期组成
- 机器周期：每个机器周期对应`CPU`内部操作或某种总线事务类型，一个总线事务访问一次主存或`I/O`接口
- 时钟周期：最小的`CPU`时间单位
- 一般来说，一个指令周期包含若干个机器周期，一个机器周期包含若干个时间周期

# 6 数据通路
根据是否与总线相连，可以将数据通络分为：

- 总线式数据通路
- 非总线式数据通路

根据是否按流水线方式进行，可以分为：

- 非流水线数据通路
- 流水线数据通路

总线式数据通路无法实现指令流水线。非总线式数据通路可以设计为：

- 单周期数据通路
- 多周期数据通路
- 流水线数据通路

# 7 控制逻辑单元
可以分为：

- 硬连线路控制器：将指令执行过程中每个时钟周期所包含的控制信号取值组合成一个状态，每来一个状态控信号就会有一个新的取值，也就是一个新的状态，实现时用组合逻辑电路来生成控制信号，用一个状态寄存器来实现状态之间的转换
- 微程序控制器：将指令执行过程中每个时钟周期所包含的控制信号取值看成是一个`0/1`序列，每个控制信号对应一个微命令，若干微命令组合成一个微指令，每条指令所包含的动作由若干条微指令完成，每来一个时钟，执行一条微指令


# 8 异常和中断
内部异常可以分成三种：

- 故障：某条正在执行的指令产生的异常
- 陷阱：预先安排的一种异常，比如调试程序时的断点
- 终止：严重的硬件故障，只能终止系统运行

外部中断是指外设或其他机器通过中断请求向`CPU`提出的处理请求，与指令的执行无关。




